name: Generate Dynamic SVG

on:
  schedule:
    # æ¯å¤©UTCæ—¶é—´00:00è¿è¡Œä¸€æ¬¡ï¼ˆåŒ—äº¬æ—¶é—´08:00ï¼‰
    - cron: '0 0 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ main, master ]
    paths:
      - '.github/workflows/dynamic-svg.yml'

jobs:
  generate-svg:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        
    - name: Generate dynamic SVG
      run: |
        # åˆ›å»ºSVGç›®å½•ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
        mkdir -p svg
        
        # ç”Ÿæˆå¸¦æœ‰"neikos"å­—æ ·çš„åŠ¨æ€SVG
        cat > svg/neikos-dynamic.svg << 'EOF'
        <svg width="400" height="100" xmlns="http://www.w3.org/2000/svg">
          <defs>
            <linearGradient id="gradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" style="stop-color:#667eea;stop-opacity:1">
                <animate attributeName="stop-color" values="#667eea;#764ba2;#f093fb;#667eea" dur="4s" repeatCount="indefinite" />
              </stop>
              <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1">
                <animate attributeName="stop-color" values="#764ba2;#f093fb;#667eea;#764ba2" dur="4s" repeatCount="indefinite" />
              </stop>
            </linearGradient>
            <filter id="glow">
              <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
              <feMerge>
                <feMergeNode in="coloredBlur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>
          
          <rect width="400" height="100" fill="#1a1a2e" rx="10"/>
          
          <text x="200" y="55" 
                font-family="'Segoe UI', Arial, sans-serif" 
                font-size="36" 
                font-weight="bold" 
                text-anchor="middle" 
                fill="url(#gradient)"
                filter="url(#glow)">
            neikos
            <animate attributeName="opacity" values="0.8;1;0.8" dur="2s" repeatCount="indefinite" />
          </text>
          
          <text x="200" y="75" 
                font-family="'Segoe UI', Arial, sans-serif" 
                font-size="12" 
                text-anchor="middle" 
                fill="#888">
            Last updated: $(date '+%Y-%m-%d %H:%M:%S UTC')
            <animate attributeName="opacity" values="0.5;1;0.5" dur="3s" repeatCount="indefinite" />
          </text>
        </svg>
        EOF
        
        # ä½¿ç”¨å®é™…æ—¶é—´æ›¿æ¢å ä½ç¬¦
        sed -i "s/\$(date '+%Y-%m-%d %H:%M:%S UTC')/$(date -u '+%Y-%m-%d %H:%M:%S UTC')/g" svg/neikos-dynamic.svg
        
    - name: Commit and push changes
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add svg/neikos-dynamic.svg
        if git diff --staged --quiet; then
          echo "No changes to commit"
        else
          git commit -m "ğŸ¨ Update dynamic SVG - $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          git push
        fi
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}